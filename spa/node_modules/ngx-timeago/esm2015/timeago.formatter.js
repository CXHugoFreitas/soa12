/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Injectable } from '@angular/core';
import { TimeagoIntl } from './timeago.intl';
import { MINUTE, HOUR, DAY, WEEK, MONTH, YEAR } from './util';
import * as ɵngcc0 from '@angular/core';
const /** @type {?} */ defaultFormattter = function (then) {
    const /** @type {?} */ now = Date.now();
    const /** @type {?} */ seconds = Math.round(Math.abs(now - then) / 1000);
    const /** @type {?} */ suffix = then < now ? 'ago' : 'from now';
    const [value, unit] = seconds < MINUTE
        ? [Math.round(seconds), 'second']
        : seconds < HOUR
            ? [Math.round(seconds / MINUTE), 'minute']
            : seconds < DAY
                ? [Math.round(seconds / HOUR), 'hour']
                : seconds < WEEK
                    ? [Math.round(seconds / DAY), 'day']
                    : seconds < MONTH
                        ? [Math.round(seconds / WEEK), 'week']
                        : seconds < YEAR
                            ? [Math.round(seconds / MONTH), 'month']
                            : [Math.round(seconds / YEAR), 'year'];
    return { value, unit, suffix };
};
const ɵ0 = defaultFormattter;
/**
 * @abstract
 */
export class TimeagoFormatter {
}
function TimeagoFormatter_tsickle_Closure_declarations() {
    /**
     * @abstract
     * @param {?} then
     * @return {?}
     */
    TimeagoFormatter.prototype.format = function (then) { };
}
export class TimeagoDefaultFormatter extends TimeagoFormatter {
    /**
     * @param {?} then
     * @return {?}
     */
    format(then) {
        const { suffix, value, unit } = defaultFormattter(then);
        return this.parse(value, unit, suffix);
    }
    /**
     * @param {?} value
     * @param {?} unit
     * @param {?} suffix
     * @return {?}
     */
    parse(value, unit, suffix) {
        if (value !== 1) {
            unit += 's';
        }
        return value + ' ' + unit + ' ' + suffix;
    }
}
TimeagoDefaultFormatter.ɵfac = function TimeagoDefaultFormatter_Factory(t) { return ɵTimeagoDefaultFormatter_BaseFactory(t || TimeagoDefaultFormatter); };
TimeagoDefaultFormatter.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: TimeagoDefaultFormatter, factory: TimeagoDefaultFormatter.ɵfac });
const ɵTimeagoDefaultFormatter_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(TimeagoDefaultFormatter);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(TimeagoDefaultFormatter, [{
        type: Injectable
    }], null, null); })();
export class TimeagoCustomFormatter extends TimeagoFormatter {
    /**
     * @param {?} intl
     */
    constructor(intl) {
        super();
        this.intl = intl;
    }
    /**
     * @param {?} then
     * @return {?}
     */
    format(then) {
        const { suffix, value, unit } = defaultFormattter(then);
        return this.parse(value, unit, suffix, Date.now(), then);
    }
    /**
     * @param {?} value
     * @param {?} unit
     * @param {?} suffix
     * @param {?} now
     * @param {?} then
     * @return {?}
     */
    parse(value, unit, suffix, now, then) {
        /** convert weeks to days if strings don't handle weeks */
        if (unit === 'week' && !this.intl.strings.week && !this.intl.strings.weeks) {
            const /** @type {?} */ days = Math.round(Math.abs(now - then) / (1000 * 60 * 60 * 24));
            value = days;
            unit = 'day';
        }
        /**
         * create a normalize function for given value
         */
        const /** @type {?} */ normalize = this.normalizeFn(value, now - then, this.intl.strings.numbers);
        /**
         * The eventual return value stored in an array so that the wordSeparator can be used
         */
        const /** @type {?} */ dateString = [];
        /** handle prefixes */
        if (suffix === 'ago' && this.intl.strings.prefixAgo) {
            dateString.push(normalize(this.intl.strings.prefixAgo));
        }
        if (suffix === 'from now' && this.intl.strings.prefixFromNow) {
            dateString.push(normalize(this.intl.strings.prefixFromNow));
        }
        /**
         * Handle Main number and unit
         */
        const /** @type {?} */ isPlural = value > 1;
        if (isPlural) {
            const /** @type {?} */ stringFn = this.intl.strings[unit + 's'] || this.intl.strings[unit] || '%d ' + unit;
            dateString.push(normalize(stringFn));
        }
        else {
            const /** @type {?} */ stringFn = this.intl.strings[unit] || this.intl.strings[unit + 's'] || '%d ' + unit;
            dateString.push(normalize(stringFn));
        }
        /** Handle Suffixes */
        if (suffix === 'ago' && this.intl.strings.suffixAgo) {
            dateString.push(normalize(this.intl.strings.suffixAgo));
        }
        if (suffix === 'from now' && this.intl.strings.suffixFromNow) {
            dateString.push(normalize(this.intl.strings.suffixFromNow));
        }
        /**
         * join the array into a string and return it
         */
        const /** @type {?} */ wordSeparator = typeof this.intl.strings.wordSeparator === 'string' ? this.intl.strings.wordSeparator : ' ';
        return dateString.join(wordSeparator);
    }
    /**
     * If the numbers array is present, format numbers with it,
     * otherwise just cast the number to a string and return it
     * @param {?} numbers
     * @param {?} value
     * @return {?}
     */
    normalizeNumber(numbers, value) {
        return numbers && numbers.length === 10
            ? String(value).split('')
                .map((digit) => digit.match(/^[0-9]$/) ? numbers[parseInt(digit, 10)] : digit)
                .join('')
            : String(value);
    }
    /**
     * Take a string or a function that takes number of days and returns a string
     * and provide a uniform API to create string parts
     * @param {?} value
     * @param {?} millisDelta
     * @param {?=} numbers
     * @return {?}
     */
    normalizeFn(value, millisDelta, numbers) {
        return (stringOrFn) => typeof stringOrFn === 'function'
            ? stringOrFn(value, millisDelta).replace(/%d/g, this.normalizeNumber(numbers, value))
            : stringOrFn.replace(/%d/g, this.normalizeNumber(numbers, value));
    }
}
TimeagoCustomFormatter.ɵfac = function TimeagoCustomFormatter_Factory(t) { return new (t || TimeagoCustomFormatter)(ɵngcc0.ɵɵinject(TimeagoIntl)); };
TimeagoCustomFormatter.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: TimeagoCustomFormatter, factory: TimeagoCustomFormatter.ɵfac });
/** @nocollapse */
TimeagoCustomFormatter.ctorParameters = () => [
    { type: TimeagoIntl }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(TimeagoCustomFormatter, [{
        type: Injectable
    }], function () { return [{ type: TimeagoIntl }]; }, null); })();
function TimeagoCustomFormatter_tsickle_Closure_declarations() {
    /** @type {?} */
    TimeagoCustomFormatter.prototype.intl;
}
export { ɵ0 };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZWFnby5mb3JtYXR0ZXIuanMiLCJzb3VyY2VzIjpbIm5nOi9uZ3gtdGltZWFnby90aW1lYWdvLmZvcm1hdHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDOztBQVU5RCx1QkFBTSxpQkFBaUIsR0FBRyxVQUFTLElBQVk7QUFBSSxJQUNqRCx1QkFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3pCLElBQUUsdUJBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDMUQsSUFBRSx1QkFBTSxNQUFNLEdBQVcsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7QUFDekQsSUFDRSxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxHQUNqQixPQUFPLEdBQUcsTUFBTTtBQUNwQixRQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUUsUUFBUSxDQUFDO0FBQ3ZDLFFBQU0sQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJO0FBQ3RCLFlBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLEVBQUUsUUFBUSxDQUFDO0FBQ2xELFlBQVEsQ0FBQyxDQUFDLE9BQU8sR0FBRyxHQUFHO0FBQ3ZCLGdCQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxL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QUFDO0FBQy9CLFFBQUksRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztBQUNuQixZQUFNLHVCQUFNLFFBQVEsR0FBZSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztBQUM1RyxZQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDM0MsU0FBSztBQUFDLFFBQUEsSUFBSSxDQUFDLENBQUM7QUFDWixZQUFNLHVCQUFNLFFBQVEsR0FBZSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztBQUM1RyxZQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDM0MsU0FBSztBQUNMO0FBRUcsUUFBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDMUQsWUFBTSxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0FBQzlELFNBQUs7QUFDTCxRQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztBQUNuRSxZQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFDbEUsU0FBSztBQUNMO0FBQ1c7QUFDQTtBQUFZLFFBQW5CLHVCQUFNLGFBQWEsR0FBRyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO0FBQ3RILFFBQUksTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDMUM7QUFFQztBQUNFO0FBQ0U7QUFFSDtBQUEwQjtBQUF3QjtBQUM5QztBQUFRLElBREosZUFBZSxDQUFDLE9BQW9CLEVBQUUsS0FBYTtBQUM3RCxRQUFJLE1BQU0sQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxFQUFFO0FBQzNDLFlBQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO0FBQy9CLGlCQUFXLEdBQUcsQ0FBQyxDQUFDLEtBQWEsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ2hHLGlCQUFXLElBQUksQ0FBQyxFQUFFLENBQUM7QUFDbkIsWUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3RCO0FBRUM7QUFDRTtBQUNFO0FBRUg7QUFBd0I7QUFBOEI7QUFDeEQ7QUFBbUI7QUFBUSxJQURqQixXQUFXLENBQUMsS0FBYSxFQUFFLFdBQW1CLEVBQUUsT0FBcUI7QUFDL0UsUUFBSSxNQUFNLENBQUMsQ0FBQyxVQUFzQixFQUFFLEVBQUUsQ0FDaEMsT0FBTyxVQUFVLEtBQUssVUFBVTtBQUN0QyxZQUFNLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDM0YsWUFBTSxDQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUN4RTtBQUVBO2tEQS9FQyxVQUFVO2tJQUNSO0FBQUM7QUFBbUI7QUFDZixZQXZEQyxXQUFXO0FBQUc7OztxRUFBRTtBQUFDO0FBQ21CO0FBRTNDO0FBQTJDO0FBQUU7O0FBSkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFVQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUVBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFYQSxBQUFBLEFBZ0JBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUE1RUEsQUFBQSxBQXJEQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGltZWFnb0ludGwgfSBmcm9tICcuL3RpbWVhZ28uaW50bCc7XG5pbXBvcnQgeyBNSU5VVEUsIEhPVVIsIERBWSwgV0VFSywgTU9OVEgsIFlFQVIgfSBmcm9tICcuL3V0aWwnO1xuXG5leHBvcnQgdHlwZSBVbml0ID0gJ3NlY29uZCcgfCAnbWludXRlJyB8ICdob3VyJyB8ICdkYXknIHwgJ3dlZWsnIHwgJ21vbnRoJyB8ICd5ZWFyJztcblxuZXhwb3J0IHR5cGUgU3VmZml4ID0gJ2FnbycgfCAnZnJvbSBub3cnO1xuXG5leHBvcnQgdHlwZSBTdHJpbmdPckZuID0gKCh2YWx1ZTogbnVtYmVyLCBtaWxsaXNEZWx0YTogIG51bWJlcikgPT4gc3RyaW5nKSB8IHN0cmluZztcblxuZXhwb3J0IHR5cGUgTnVtYmVyQXJyYXkgPSBbIHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIHN0cmluZyBdO1xuXG5jb25zdCBkZWZhdWx0Rm9ybWF0dHRlciA9IGZ1bmN0aW9uKHRoZW46IG51bWJlcik6IHt2YWx1ZTogbnVtYmVyLCB1bml0OiBVbml0LCBzdWZmaXg6IFN1ZmZpeH0ge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCBzZWNvbmRzID0gTWF0aC5yb3VuZChNYXRoLmFicyhub3cgLSB0aGVuKSAvIDEwMDApO1xuICBjb25zdCBzdWZmaXg6IFN1ZmZpeCA9IHRoZW4gPCBub3cgPyAnYWdvJyA6ICdmcm9tIG5vdyc7XG5cbiAgY29uc3QgW3ZhbHVlLCB1bml0XTogW251bWJlciwgVW5pdF0gPVxuICAgIHNlY29uZHMgPCBNSU5VVEVcbiAgICAgID8gW01hdGgucm91bmQoc2Vjb25kcyksICdzZWNvbmQnXVxuICAgICAgOiBzZWNvbmRzIDwgSE9VUlxuICAgICAgICA/IFtNYXRoLnJvdW5kKHNlY29uZHMgLyBNSU5VVEUpLCAnbWludXRlJ11cbiAgICAgICAgOiBzZWNvbmRzIDwgREFZXG4gICAgICAgICAgPyBbTWF0aC5yb3VuZChzZWNvbmRzIC8gSE9VUiksICdob3VyJ11cbiAgICAgICAgICA6IHNlY29uZHMgPCBXRUVLXG4gICAgICAgICAgICA/IFtNYXRoLnJvdW5kKHNlY29uZHMgLyBEQVkpLCAnZGF5J11cbiAgICAgICAgICAgIDogc2Vjb25kcyA8IE1PTlRIXG4gICAgICAgICAgICAgID8gW01hdGgucm91bmQoc2Vjb25kcyAvIFdFRUspLCAnd2VlayddXG4gICAgICAgICAgICAgIDogc2Vjb25kcyA8IFlFQVJcbiAgICAgICAgICAgICAgICA/IFtNYXRoLnJvdW5kKHNlY29uZHMgLyBNT05USCksICdtb250aCddXG4gICAgICAgICAgICAgICAgOiBbTWF0aC5yb3VuZChzZWNvbmRzIC8gWUVBUiksICd5ZWFyJ107XG5cbiAgcmV0dXJuIHt2YWx1ZSwgdW5pdCwgc3VmZml4fTtcbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRpbWVhZ29Gb3JtYXR0ZXIge1xuICBhYnN0cmFjdCBmb3JtYXQodGhlbjogbnVtYmVyKTogc3RyaW5nXG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBUaW1lYWdvRGVmYXVsdEZvcm1hdHRlciBleHRlbmRzIFRpbWVhZ29Gb3JtYXR0ZXIge1xuICBmb3JtYXQodGhlbjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCB7c3VmZml4LCB2YWx1ZSwgdW5pdH0gPSBkZWZhdWx0Rm9ybWF0dHRlcih0aGVuKTtcbiAgICByZXR1cm4gdGhpcy5wYXJzZSh2YWx1ZSwgdW5pdCwgc3VmZml4KTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2UodmFsdWU6IG51bWJlciwgdW5pdDogVW5pdCwgc3VmZml4OiBTdWZmaXgpOiBzdHJpbmcge1xuICAgIGlmICh2YWx1ZSAhPT0gMSkge1xuICAgICAgdW5pdCArPSAncyc7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZSArICcgJyArIHVuaXQgKyAnICcgKyBzdWZmaXg7XG4gIH1cbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRpbWVhZ29DdXN0b21Gb3JtYXR0ZXIgZXh0ZW5kcyBUaW1lYWdvRm9ybWF0dGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBpbnRsOiBUaW1lYWdvSW50bCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBmb3JtYXQodGhlbjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCB7c3VmZml4LCB2YWx1ZSwgdW5pdH0gPSBkZWZhdWx0Rm9ybWF0dHRlcih0aGVuKTtcbiAgICByZXR1cm4gdGhpcy5wYXJzZSh2YWx1ZSwgdW5pdCwgc3VmZml4LCBEYXRlLm5vdygpLCB0aGVuKTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2UodmFsdWU6IG51bWJlciwgdW5pdDogVW5pdCwgc3VmZml4OiBTdWZmaXgsIG5vdzogbnVtYmVyLCB0aGVuOiBudW1iZXIpIHtcbiAgICAvKiogY29udmVydCB3ZWVrcyB0byBkYXlzIGlmIHN0cmluZ3MgZG9uJ3QgaGFuZGxlIHdlZWtzICovXG4gICAgaWYgKHVuaXQgPT09ICd3ZWVrJyAmJiAhdGhpcy5pbnRsLnN0cmluZ3Mud2VlayAmJiAhdGhpcy5pbnRsLnN0cmluZ3Mud2Vla3MpIHtcbiAgICAgIGNvbnN0IGRheXMgPSBNYXRoLnJvdW5kKE1hdGguYWJzKG5vdyAtIHRoZW4pIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgICAgIHZhbHVlID0gZGF5cztcbiAgICAgIHVuaXQgPSAnZGF5JztcbiAgICB9XG5cbiAgICAvKiogY3JlYXRlIGEgbm9ybWFsaXplIGZ1bmN0aW9uIGZvciBnaXZlbiB2YWx1ZSAqL1xuICAgIGNvbnN0IG5vcm1hbGl6ZSA9IHRoaXMubm9ybWFsaXplRm4odmFsdWUsIG5vdyAtIHRoZW4sIHRoaXMuaW50bC5zdHJpbmdzLm51bWJlcnMpO1xuXG4gICAgLyoqIFRoZSBldmVudHVhbCByZXR1cm4gdmFsdWUgc3RvcmVkIGluIGFuIGFycmF5IHNvIHRoYXQgdGhlIHdvcmRTZXBhcmF0b3IgY2FuIGJlIHVzZWQgKi9cbiAgICBjb25zdCBkYXRlU3RyaW5nOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLyoqIGhhbmRsZSBwcmVmaXhlcyAqL1xuICAgIGlmIChzdWZmaXggPT09ICdhZ28nICYmIHRoaXMuaW50bC5zdHJpbmdzLnByZWZpeEFnbykge1xuICAgICAgZGF0ZVN0cmluZy5wdXNoKG5vcm1hbGl6ZSh0aGlzLmludGwuc3RyaW5ncy5wcmVmaXhBZ28pKTtcbiAgICB9XG4gICAgaWYgKHN1ZmZpeCA9PT0gJ2Zyb20gbm93JyAmJiB0aGlzLmludGwuc3RyaW5ncy5wcmVmaXhGcm9tTm93KSB7XG4gICAgICBkYXRlU3RyaW5nLnB1c2gobm9ybWFsaXplKHRoaXMuaW50bC5zdHJpbmdzLnByZWZpeEZyb21Ob3cpKTtcbiAgICB9XG5cbiAgICAvKiogSGFuZGxlIE1haW4gbnVtYmVyIGFuZCB1bml0ICovXG4gICAgY29uc3QgaXNQbHVyYWwgPSB2YWx1ZSA+IDE7XG4gICAgaWYgKGlzUGx1cmFsKSB7XG4gICAgICBjb25zdCBzdHJpbmdGbjogU3RyaW5nT3JGbiA9IHRoaXMuaW50bC5zdHJpbmdzW3VuaXQgKyAncyddIHx8IHRoaXMuaW50bC5zdHJpbmdzW3VuaXRdIHx8ICclZCAnICsgdW5pdDtcbiAgICAgIGRhdGVTdHJpbmcucHVzaChub3JtYWxpemUoc3RyaW5nRm4pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3RyaW5nRm46IFN0cmluZ09yRm4gPSB0aGlzLmludGwuc3RyaW5nc1t1bml0XSB8fCB0aGlzLmludGwuc3RyaW5nc1t1bml0ICsgJ3MnXSB8fCAnJWQgJyArIHVuaXQ7XG4gICAgICBkYXRlU3RyaW5nLnB1c2gobm9ybWFsaXplKHN0cmluZ0ZuKSk7XG4gICAgfVxuXG4gICAgLyoqIEhhbmRsZSBTdWZmaXhlcyAqL1xuICAgIGlmIChzdWZmaXggPT09ICdhZ28nICYmIHRoaXMuaW50bC5zdHJpbmdzLnN1ZmZpeEFnbykge1xuICAgICAgZGF0ZVN0cmluZy5wdXNoKG5vcm1hbGl6ZSh0aGlzLmludGwuc3RyaW5ncy5zdWZmaXhBZ28pKTtcbiAgICB9XG4gICAgaWYgKHN1ZmZpeCA9PT0gJ2Zyb20gbm93JyAmJiB0aGlzLmludGwuc3RyaW5ncy5zdWZmaXhGcm9tTm93KSB7XG4gICAgICBkYXRlU3RyaW5nLnB1c2gobm9ybWFsaXplKHRoaXMuaW50bC5zdHJpbmdzLnN1ZmZpeEZyb21Ob3cpKTtcbiAgICB9XG5cbiAgICAvKiogam9pbiB0aGUgYXJyYXkgaW50byBhIHN0cmluZyBhbmQgcmV0dXJuIGl0ICovXG4gICAgY29uc3Qgd29yZFNlcGFyYXRvciA9IHR5cGVvZiB0aGlzLmludGwuc3RyaW5ncy53b3JkU2VwYXJhdG9yID09PSAnc3RyaW5nJyA/IHRoaXMuaW50bC5zdHJpbmdzLndvcmRTZXBhcmF0b3IgOiAnICc7XG4gICAgcmV0dXJuIGRhdGVTdHJpbmcuam9pbih3b3JkU2VwYXJhdG9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0aGUgbnVtYmVycyBhcnJheSBpcyBwcmVzZW50LCBmb3JtYXQgbnVtYmVycyB3aXRoIGl0LFxuICAgKiBvdGhlcndpc2UganVzdCBjYXN0IHRoZSBudW1iZXIgdG8gYSBzdHJpbmcgYW5kIHJldHVybiBpdFxuICAqL1xuICBwcml2YXRlIG5vcm1hbGl6ZU51bWJlcihudW1iZXJzOiBOdW1iZXJBcnJheSwgdmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiBudW1iZXJzICYmIG51bWJlcnMubGVuZ3RoID09PSAxMFxuICAgICAgPyBTdHJpbmcodmFsdWUpLnNwbGl0KCcnKVxuICAgICAgICAgIC5tYXAoKGRpZ2l0OiBzdHJpbmcpID0+IGRpZ2l0Lm1hdGNoKC9eWzAtOV0kLykgPyBudW1iZXJzW3BhcnNlSW50KGRpZ2l0LCAxMCldIDogZGlnaXQpXG4gICAgICAgICAgLmpvaW4oJycpXG4gICAgICA6IFN0cmluZyh2YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhIHN0cmluZyBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgbnVtYmVyIG9mIGRheXMgYW5kIHJldHVybnMgYSBzdHJpbmdcbiAgICogYW5kIHByb3ZpZGUgYSB1bmlmb3JtIEFQSSB0byBjcmVhdGUgc3RyaW5nIHBhcnRzXG4gICovXG4gIHByaXZhdGUgbm9ybWFsaXplRm4odmFsdWU6IG51bWJlciwgbWlsbGlzRGVsdGE6IG51bWJlciwgbnVtYmVycz86IE51bWJlckFycmF5KSB7XG4gICAgcmV0dXJuIChzdHJpbmdPckZuOiBTdHJpbmdPckZuKSA9PlxuICAgICAgdHlwZW9mIHN0cmluZ09yRm4gPT09ICdmdW5jdGlvbidcbiAgICAgID8gc3RyaW5nT3JGbih2YWx1ZSwgbWlsbGlzRGVsdGEpLnJlcGxhY2UoLyVkL2csIHRoaXMubm9ybWFsaXplTnVtYmVyKG51bWJlcnMsIHZhbHVlKSlcbiAgICAgIDogc3RyaW5nT3JGbi5yZXBsYWNlKC8lZC9nLCB0aGlzLm5vcm1hbGl6ZU51bWJlcihudW1iZXJzLCB2YWx1ZSkpO1xuICB9XG59XG4iXX0=